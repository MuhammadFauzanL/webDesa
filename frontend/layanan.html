<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WebDesa - Layanan</title>
    <link href="/src/style.css" rel="stylesheet">
    <script defer src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js"></script>
    <script src="/src/auth.js" defer></script>
</head>
<body class="bg-gray-50">
    <header x-data="navState" x-init="init()" class="flex items-center justify-between md:px-[8vw] px-[3vw] bg-white h-14 text-black shadow-sm fixed top-0 left-0 w-full z-50">
        <div class="logo"><a class="flex items-center gap-1" href="index.html"><img class="h-7 -mt-1" src="https://img.icons8.com/pastel-glyph/64/40C057/marker--v1.png" alt="marker--v1" /><span class="text-lg font-bold">Desa Cibiru</span></a></div>
        <nav>
            <ul class="flex font-medium items-center gap-4">
                <li><a href="index.html" class="hover:text-emerald-600">Profil</a></li>
                <li><a href="berita.html" class="hover:text-emerald-600">Berita</a></li>
                 
                <li><a href="layanan.html" class="hover:text-emerald-600 font-semibold text-emerald-600">Layanan</a></li>
                <li><a href="/login.html" class="hover:text-emerald-600">Login</a></li>
                <template x-if="isAdmin"><li><a href="admin.html" class="font-semibold text-red-600 hover:text-red-700">Admin Panel</a></li></template>
                <template x-if="isLoggedIn"><li><button @click="logout()" class="bg-gray-200 text-sm font-semibold px-4 py-1.5 rounded-md hover:bg-red-500 hover:text-white transition">Logout</button></li></template>
                <template x-if="!isLoggedIn"><li><a href="login.html" class="bg-emerald-600 text-sm font-semibold text-white px-4 py-1.5 rounded-md hover:bg-emerald-700">Login</a></li></template>
            </ul>
        </nav>
    </header>

    <main class="flex flex-col w-full min-h-screen pt-24 pb-12">
        <div class="container mx-auto px-4 sm:px-6 lg:px-8">
            <div class="text-center mb-10">
                <h1 class="text-3xl text-[#139B82] font-semibold">Layanan Masyarakat Desa</h1>
                <p class="text-gray-600 mt-2">Sampaikan aspirasi Anda atau ajukan peminjaman sarana dengan mudah.</p>
            </div>
            <div class="max-w-6xl mx-auto grid grid-cols-1 md:grid-cols-2 gap-8">
                <div class="bg-white rounded-2xl shadow-lg p-6 space-y-4" x-data="aspirasiForm()">
                    <div class="flex items-center gap-3 text-gray-800 font-semibold text-xl pb-2"><svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-emerald-600" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5.121 17.804A4.992 4.992 0 017 17h10a4.992 4.992 0 011.879.804M15 11a3 3 0 11-6 0 3 3 0 016 0z" /></svg><span>Aspirasi Masyarakat</span></div>
                    <form @submit.prevent="kirimAspirasi" class="space-y-4">
                        <input type="text" x-model="formData.nama" placeholder="Nama Anda" required class="w-full p-3 rounded-md bg-gray-50 border border-gray-300 text-sm">
                        <textarea rows="4" x-model="formData.aspirasi" placeholder="Sampaikan aspirasi, saran, dan keluhan Anda di sini..." required class="w-full p-3 rounded-md bg-gray-50 border border-gray-300 text-sm"></textarea>
                        <button type="submit" class="w-full bg-[#139B82] text-white py-2 rounded-md hover:bg-emerald-700 font-semibold transition">Kirim Aspirasi</button>
                    </form>
                </div>
                <div class="bg-white rounded-2xl shadow-lg p-6 space-y-4" x-data="peminjamanForm()">
                    <div class="flex items-center gap-3 text-gray-800 font-semibold text-xl pb-2"><svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-emerald-600" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 7v4a1 1 0 001 1h3m10 0h3a1 1 0 001-1V7M6 21h12a2 2 0 002-2v-7H4v7a2 2 0 002 2z" /></svg><span>Peminjaman Sarana/Prasarana</span></div>
                    <template x-if="isLoggedIn">
                        <form @submit.prevent="ajukanPeminjaman" class="space-y-4">
                            <input type="text" x-model="formData.nama" placeholder="Nama Pemohon" required class="w-full p-3 rounded-md bg-gray-50 border border-gray-300 text-sm">
                            <input type="text" x-model="formData.barang" placeholder="Barang yang Dipinjam (Contoh: Tenda, Kursi)" required class="w-full p-3 rounded-md bg-gray-50 border border-gray-300 text-sm">
                            <input type="text" x-model="formData.keperluan" placeholder="Keperluan" required class="w-full p-3 rounded-md bg-gray-50 border border-gray-300 text-sm">
                            <input type="date" x-model="formData.tanggalPinjam" required class="w-full p-3 rounded-md bg-gray-50 border border-gray-300 text-sm">
                            <button type="submit" class="w-full bg-[#139B82] text-white py-2 rounded-md hover:bg-emerald-700 font-semibold transition">Ajukan Peminjaman</button>
                        </form>
                    </template>
                    <template x-if="!isLoggedIn">
                        <div class="text-center text-gray-600 bg-gray-100 p-4 rounded-md">
                            <p>Anda harus <a href="login.html" class="text-emerald-600 font-bold hover:underline">login</a> terlebih dahulu untuk mengajukan peminjaman.</p>
                        </div>
                    </template>
                </div>
            </div>
        </div>
    </main>
    <footer class="bg-[#139B82] text-white py-4 text-center text-sm">Â© 2025 Desa Cibiru - All rights reserved.</footer>

    <script>
        // PERHATIKAN: <script type="module"> DIHAPUS
        // PERHATIKAN: import { API_URL } DIHAPUS

        function aspirasiForm() {
            return {
                formData: { nama: '', aspirasi: '' },
                async kirimAspirasi() {
                    try {
                        // URL di-hardcode kembali HANYA UNTUK TES
                        const response = await fetch('http://localhost:5000/api/aspirasi', {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify(this.formData)
                        });
                        const data = await response.json();
                        if (!response.ok) throw new Error(data.message || 'Gagal mengirim aspirasi');
                        alert('Terima kasih! Aspirasi Anda telah berhasil dikirim.');
                        this.formData.nama = '';
                        this.formData.aspirasi = '';
                    } catch (error) {
                        alert(error.message);
                    }
                }
            }
        }

        function peminjamanForm() {
            return {
                formData: { nama: '', barang: '', keperluan: '', tanggalPinjam: '' },
                isLoggedIn: localStorage.getItem('token') ? true : false,
                async ajukanPeminjaman() {
                    const token = localStorage.getItem('token');
                    if (!token) {
                        alert('Sesi Anda telah habis, silakan login kembali.');
                        return;
                    }
                    try {
                        // URL di-hardcode kembali HANYA UNTUK TES
                        const response = await fetch('http://localhost:5000/api/peminjaman', {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json', 'Authorization': `Bearer ${token}` },
                            body: JSON.stringify(this.formData)
                        });
                        const data = await response.json();
                        if (!response.ok) throw new Error(data.message || 'Gagal mengajukan peminjaman');
                        alert('Pengajuan peminjaman Anda telah berhasil dikirim.');
                        this.formData = { nama: '', barang: '', keperluan: '', tanggalPinjam: '' };
                    } catch (error) {
                        alert(error.message);
                    }
                }
            }
        }

       
    </script>
</body>
</html>